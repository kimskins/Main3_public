using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using MySql.Data.MySqlClient;
using Excel = Microsoft.Office.Interop.Excel;

namespace Dukyou3
{
    public partial class Form_501 : Form
    {
        SourceGrid.Cells.Controllers.CustomEvents ValueChangEvent1 = new SourceGrid.Cells.Controllers.CustomEvents();//
        SourceGrid.Cells.Controllers.CustomEvents DoubleClickEvent1 = new SourceGrid.Cells.Controllers.CustomEvents();
        SourceGrid.Cells.Controllers.CustomEvents clicked1 = new SourceGrid.Cells.Controllers.CustomEvents();
        SourceGridControl GridHandle = new SourceGridControl();
        ksgcontrol kc_macro = new ksgcontrol();
        ksgcontrol kc_sang = new ksgcontrol();
        DataTable s_dt = new DataTable();   //메인항목 
        cell_d cc = new cell_d();
        string DB_TableName_paper = "C_paper";
        string DB_TableName_cust_code = "C_hcust_jiup_code";
        string DB_TableName_hang = "hang_manage";
        string DB_TableName_paper_hcust = "C_paper_hcust_manage";
        string DB_TableName_hcust = "C_hcustomer";
        Boolean Chk = false;
        string refresh_Query = "";
        
        public Form_501()
        {
            InitializeComponent();
        }

        private void Form_502_Load(object sender, EventArgs e)
        {
            this.Cursor = Cursors.WaitCursor;
            Screen srn = Screen.PrimaryScreen;
            int Xb = this.Width;   //좌,우
            int Yb = this.Height;  //위,아래
            this.Location = new Point((srn.Bounds.Width - Xb) / 2, 1);  //좌/우,위/아래

            kc_macro.ControlInit(Config.DB_conMacro, null, null, null);
            kc_sang.ControlInit(Config.DB_conMacro_sang, null, null, null);
            SourceGrid.Cells.Controllers.CustomEvents val_c1 = new SourceGrid.Cells.Controllers.CustomEvents();
            val_c1.ValueChanged += new EventHandler(ValueChangedEvent1);

            ksgcontrol kc = new ksgcontrol();
            kc.ControlInit(Config.DB_con1, "", "", "");
            string cQuery = ""; 

            cQuery = "select hang from hang_manage where class = '%분류' order by no";
            kc.ComboBoxItemInsert("hang", cbBunryu, cQuery);
            kc.ComboBoxItemInsert("hang", cbS_bunryu, cQuery);

            cQuery = "select hang from hang_manage where class = '종이그룹' order by no";
            kc.ComboBoxItemInsert("hang", cbPgroup, cQuery);
            kc.ComboBoxItemInsert("hang", cbS_pgroup, cQuery);

            cQuery = "select hang from hang_manage where class = '제지사' order by no";
            kc.ComboBoxItemInsert("hang", cbPmake, cQuery);
            kc.ComboBoxItemInsert("hang", cbS_pmake, cQuery);

            cQuery = "select paper_name from "+DB_TableName_paper+" where favorite = true order by sort_no ";
            kc.ComboBoxItemInsert("paper_name", cbS_pname, cQuery);

            //cQuery = "select h.sangho as sangho, b.*, c.code, d.hang as bunryu, e.hang as pgroup, f.hang as pmake from " + DB_TableName_paper_hcust + " as a ";
            //cQuery += " left outer join " + DB_TableName_paper + " as b on a.paper_id = b.row_id";  //기존에는 기준을 manage에 잡았었음
            cQuery = "select h.sangho as sangho, a.*, c.code, d.hang as bunryu, e.hang as pgroup, f.hang as pmake,g.hang as p_use from " + DB_TableName_paper + " as a ";
            cQuery += " left outer join " + DB_TableName_paper_hcust + " as b on b.paper_id = a.row_id";
            cQuery += " left outer join " + DB_TableName_cust_code + " as c on a.hcust_id = c.hcust_id";
            cQuery += " left outer join " + DB_TableName_hang + " as d on a.hang_class_code = d.code1 and d.class = '%분류' ";
            cQuery += " left outer join " + DB_TableName_hang + " as e on a.hang_pgroup_code = e.code1 and e.class = '종이그룹'";
            cQuery += " left outer join " + DB_TableName_hang + " as f on a.hang_pmake_code = f.code1 and f.class = '제지사' ";
            cQuery += " left outer join " + DB_TableName_hang + " as g on a.hang_puse_group = g.code1 and g.class = '종이용도' ";
            cQuery += " left outer join " + DB_TableName_hcust + " as h on a.hcust_id = h.row_id";
            cQuery += " order by paper_name, a.paper_weight, a.row_id, c.code";
            Refresh(cQuery);
            this.Cursor = Cursors.Default;
        }

        private void Refresh(string cQuery)
        {
            this.Cursor = Cursors.WaitCursor;
            make_m_dt(cQuery);
            make_grid1();
            this.Cursor = Cursors.Default;
        }

        private void make_m_dt(string cQuery)    //table(m_dt) 만들기+
        {
            bool ch1;
            bool ch2;
            string ch3;
            int i_no = 1;
            //   
            if (this.s_dt.Columns.Count == 0)
            {
                #region
                this.s_dt.Columns.Add("row_id", typeof(string));
                this.s_dt.Columns.Add("check1", typeof(bool));
                this.s_dt.Columns.Add("no", typeof(int));
                this.s_dt.Columns.Add("bunryu", typeof(string));
                this.s_dt.Columns.Add("pgroup", typeof(string));
                this.s_dt.Columns.Add("favorite", typeof(bool));
                this.s_dt.Columns.Add("paper_weight", typeof(string));
                this.s_dt.Columns.Add("paper_name", typeof(string));
                this.s_dt.Columns.Add("paper_color", typeof(string));
                this.s_dt.Columns.Add("pmake", typeof(string));
                this.s_dt.Columns.Add("notice_price", typeof(string));
                this.s_dt.Columns.Add("paper_size_group", typeof(string));
                this.s_dt.Columns.Add("yunjeon_size_group", typeof(string));
                this.s_dt.Columns.Add("digital_size_group", typeof(string));
                this.s_dt.Columns.Add("paper_thick", typeof(string));
                this.s_dt.Columns.Add("make_company_code", typeof(string));
                this.s_dt.Columns.Add("paper_name_code", typeof(string));
                this.s_dt.Columns.Add("prove_paper_thick", typeof(bool));
                this.s_dt.Columns.Add("sock", typeof(string));
                this.s_dt.Columns.Add("ton_su", typeof(string));
                this.s_dt.Columns.Add("sunsu", typeof(string));
                this.s_dt.Columns.Add("hang_puse_group", typeof(string));
                this.s_dt.Columns.Add("supply_company_code", typeof(string));  //유통회사 코드모음
                this.s_dt.Columns.Add("code", typeof(string));                 //유통회사(1) web에서 사용 
                this.s_dt.Columns.Add("sangho", typeof(string));
                this.s_dt.Columns.Add("macro", typeof(string));
                this.s_dt.Columns.Add("ton_price", typeof(string));
                #endregion
            }
            else
                s_dt.Rows.Clear();
            //
            DataTable m_dt = new DataTable();
            m_dt = s_dt.Clone();
            //  
            MySqlConnection DBConn;
            DBConn = new MySqlConnection(Config.DB_con1);
            DBConn.Open();
            var cmd = new MySqlCommand(cQuery, DBConn);
            var myRead = cmd.ExecuteReader();
            string f_row_id = "";
            //
            while (myRead.Read())
            {
                if (myRead["favorite"].Equals(true))
                    ch1 = true;
                else
                    ch1 = false;
                //
                if(myRead["prove_paper_thick"].Equals(true))
                    ch2 = true;
                else
                    ch2 = false;
                //
                if (myRead["macro"].Equals(true))
                    ch3 = "O";
                else
                    ch3 = "";
                //
                if (f_row_id != myRead["row_id"].ToString())
                {

                    m_dt.Rows.Add(new object[] {
                    myRead["row_id"].ToString(),
                    false,
                    i_no,
                    myRead["bunryu"].ToString(),
                    myRead["pgroup"].ToString(),
                    ch1,
                    c_string.Rzero_Icoma(myRead["paper_weight"].ToString()),
                    myRead["paper_name"].ToString(),
                    myRead["paper_color"].ToString(),
                    myRead["pmake"].ToString(),
                    c_string.Rzero_Icoma(myRead["notice_price"].ToString()),
                    myRead["paper_size_group"].ToString(),
                    myRead["yunjeon_size_group"].ToString(),
                    myRead["digital_size_group"].ToString(),
                    c_string.Rzero_Icoma(myRead["paper_thick"].ToString()),
                    myRead["make_company_code"].ToString(),
                    myRead["paper_name_code"].ToString(),
                    ch2,
                    myRead["sock"].ToString(),
                    myRead["ton_su"].ToString(),
                    myRead["sunsu"].ToString(),
                    myRead["hang_puse_group"].ToString(),
                    myRead["supply_company_code"].ToString(),  //유통회사 코드모음
                    myRead["p_use"].ToString(),
                    myRead["sangho"].ToString(),
                    ch3,
                    c_string.Rzero_Icoma(myRead["ton_price"].ToString())});
                    i_no++;
                    f_row_id = myRead["row_id"].ToString(); 
                }
            }
            s_dt = m_dt.Copy();
        }

        private void make_grid1()  //datagrid
        {
            dataGrid1.Columns.Clear();
            cell_d cc = new cell_d();
            cEventHelper.RemoveAllEventHandlers(ValueChangEvent1);
            cEventHelper.RemoveAllEventHandlers(DoubleClickEvent1);
            cEventHelper.RemoveAllEventHandlers(clicked1);
            //
            DataView sView;
            sView = s_dt.DefaultView;
            sView.AllowDelete = true;
            sView.AllowNew = false;
            sView.AllowEdit = true;
            //
            DevAge.ComponentModel.IBoundList bd = new DevAge.ComponentModel.BoundDataView(sView);
            dataGrid1.DataSource = bd;
            dataGrid1.SelectionMode = SourceGrid.GridSelectionMode.Cell;
            dataGrid1.Rows.HeaderHeight = 40;
            dataGrid1.Rows.RowHeight = 24;
            dataGrid1.EnableSort = false;
            //
            dataGrid1.Columns[0].Visible = false;

            dataGrid1.Columns[1].HeaderCell = new MyHeader1("√");
            dataGrid1.Columns[1].Width = 30;
            dataGrid1.Columns[1].HeaderCell.AddController(clicked1);

            dataGrid1.Columns[2].HeaderCell = new MyHeader("No");
            dataGrid1.Columns[2].Width = 46;
            dataGrid1.Columns[2].DataCell.View = cc.center_cell;
            dataGrid1.Columns[2].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[3].HeaderCell = new MyHeader("%분 류");
            dataGrid1.Columns[3].Width = 90;
            dataGrid1.Columns[3].DataCell.View = cc.center_cellb;
            dataGrid1.Columns[3].DataCell.Editor = cc.disable_cell;
            dataGrid1.Columns[3].DataCell.AddController(DoubleClickEvent1);
            // 
            dataGrid1.Columns[4].HeaderCell = new MyHeader("종이구룹");
            dataGrid1.Columns[4].Width = 70;
            dataGrid1.Columns[4].DataCell.View = cc.center_cell;
            dataGrid1.Columns[4].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[5].HeaderCell = new MyHeader1("검색순위");
            dataGrid1.Columns[5].Width = 80;
            // 
            dataGrid1.Columns[6].HeaderCell = new MyHeader("무게(g)");
            dataGrid1.Columns[6].Width = 60;
            dataGrid1.Columns[6].DataCell.View = cc.int_cellr;
            dataGrid1.Columns[6].DataCell.AddController(ValueChangEvent1);
            // 
            dataGrid1.Columns[7].HeaderCell = new MyHeader("종 이 명");
            dataGrid1.Columns[7].Width = 80;
            dataGrid1.Columns[7].DataCell.View = cc.center_cellr;
            dataGrid1.Columns[7].DataCell.AddController(ValueChangEvent1);
            // 
            dataGrid1.Columns[8].HeaderCell = new MyHeader("색  상");
            dataGrid1.Columns[8].Width = 90;
            dataGrid1.Columns[8].DataCell.View = cc.center_cellr;
            dataGrid1.Columns[8].DataCell.AddController(ValueChangEvent1);
            // 
            dataGrid1.Columns[9].HeaderCell = new MyHeader("제지사");
            dataGrid1.Columns[9].Width = 90;
            dataGrid1.Columns[9].DataCell.View = cc.center_cell;
            dataGrid1.Columns[9].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[10].HeaderCell = new MyHeader("공시단가");
            dataGrid1.Columns[10].Width = 80;
            dataGrid1.Columns[10].DataCell.View = cc.int_cellr;
            dataGrid1.Columns[10].DataCell.AddController(ValueChangEvent1);
            // 
            dataGrid1.Columns[11].HeaderCell = new MyHeader("매　엽" + "\r\n" + "사이즈그룹");
            dataGrid1.Columns[11].Width = 140;
            dataGrid1.Columns[11].DataCell.View = cc.left_cell;
            dataGrid1.Columns[11].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[12].HeaderCell = new MyHeader("윤　전" + "\r\n" + "사이즈그룹");
            dataGrid1.Columns[12].Width = 140;
            dataGrid1.Columns[12].DataCell.View = cc.left_cell;
            dataGrid1.Columns[12].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[13].HeaderCell = new MyHeader("디지털윤전" + "\r\n" + "사이즈그룹");
            dataGrid1.Columns[13].Width = 140;
            dataGrid1.Columns[13].DataCell.View = cc.left_cell;
            dataGrid1.Columns[13].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[14].HeaderCell = new MyHeader("두께");
            dataGrid1.Columns[14].Width = 80;
            dataGrid1.Columns[14].DataCell.View = cc.int_cellr;
            dataGrid1.Columns[14].DataCell.AddController(ValueChangEvent1);
            // 
            dataGrid1.Columns[15].HeaderCell = new MyHeader("제작사" + "\r\n" + "코드");
            dataGrid1.Columns[15].Width = 80;
            dataGrid1.Columns[15].DataCell.View = cc.center_cell;
            dataGrid1.Columns[15].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[16].HeaderCell = new MyHeader("종이명" + "\r\n" + "코드");
            dataGrid1.Columns[16].Width = 80;
            dataGrid1.Columns[16].DataCell.View = cc.center_cell;
            dataGrid1.Columns[16].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[17].HeaderCell = new MyHeader("제공");
            dataGrid1.Columns[17].Width = 60;
            dataGrid1.Columns[17].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[18].HeaderCell = new MyHeader("속(장)");
            dataGrid1.Columns[18].Width = 60;
            dataGrid1.Columns[18].DataCell.View = cc.center_cellr;
            dataGrid1.Columns[18].DataCell.AddController(ValueChangEvent1);
            // 
            dataGrid1.Columns[19].HeaderCell = new MyHeader("톤수");
            dataGrid1.Columns[19].Width = 70;
            dataGrid1.Columns[19].DataCell.View = cc.int_cell;
            dataGrid1.Columns[19].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[20].HeaderCell = new MyHeader("선수");
            dataGrid1.Columns[20].Width = 80;
            dataGrid1.Columns[20].DataCell.View = cc.center_cell;
            dataGrid1.Columns[20].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[21].HeaderCell = new MyHeader("용도");
            dataGrid1.Columns[21].Width = 80;
            dataGrid1.Columns[21].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[22].HeaderCell = new MyHeader("유통업체" + "\r\n" + "코드");
            dataGrid1.Columns[22].Width = 160;
            dataGrid1.Columns[22].DataCell.View = cc.center_cell;
            dataGrid1.Columns[22].DataCell.Editor = cc.disable_cell;
            //
            dataGrid1.Columns[23].HeaderCell = new MyHeader("지업사" + "\r\n" + "코드");
            dataGrid1.Columns[23].Width = 80;
            dataGrid1.Columns[23].DataCell.View = cc.center_cell;
            dataGrid1.Columns[23].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[24].HeaderCell = new MyHeader("관리업체");
            dataGrid1.Columns[24].Width = 120;
            dataGrid1.Columns[24].DataCell.View = cc.center_cell;
            dataGrid1.Columns[24].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[25].HeaderCell = new MyHeader("macro");
            dataGrid1.Columns[25].Width = 80;
            dataGrid1.Columns[25].DataCell.View = cc.center_cell;
            dataGrid1.Columns[25].DataCell.Editor = cc.disable_cell;
            // 
            dataGrid1.Columns[26].HeaderCell = new MyHeader("톤당단가");
            dataGrid1.Columns[26].Width = 90;
            dataGrid1.Columns[26].DataCell.View = cc.int_cellr;
            dataGrid1.Columns[26].DataCell.AddController(ValueChangEvent1);

            ValueChangEvent1.ValueChanged += ValueChangedEvent1;
            DoubleClickEvent1.DoubleClick += grid1_DoubleClick;
            clicked1.Click += grid_clicked;
        }
        private void grid_clicked(object sender, EventArgs e)
        {
            cEventHelper.RemoveAllEventHandlers(clicked1);

            bool x_id;
            int x = 0;

            for (int n = 0; n < s_dt.Rows.Count; n++)  //조치
            {
                if (Convert.ToBoolean(s_dt.Rows[n][1].ToString()) == true)
                {
                    x = 1;
                }
            }
            if (x == 1)
                x_id = false;
            else
                x_id = true;
            //
            for (int n = 0; n < s_dt.Rows.Count; n++)  //조치
            {
                s_dt.Rows[n][1] = x_id;
            }
            clicked1.Click += grid_clicked;
        }


        private void ValueChangedEvent1(object sender, EventArgs e)  //Grid1에서 볼륨첸지
        {
            cEventHelper.RemoveAllEventHandlers(ValueChangEvent1);
            string cQuery = "";  
            MySqlConnection DBConn;
            DBConn = new MySqlConnection(Config.DB_con1);
            DBConn.Open();
            //
            object[] rows = dataGrid1.SelectedDataRows;
            DataRowView row = (DataRowView)rows[0];
            //
            if (rows != null && rows.Length > 0)
            {
                int cpos = dataGrid1.Selection.ActivePosition.Column;
                int rpos = dataGrid1.Selection.ActivePosition.Row;
                string _row_id = row["row_id"].ToString();
                string dat = row[cpos].ToString().Replace(",", "");
                
                //
                if (cpos.Equals(6))    //
                {
                    if (dat == "" || dat == " ")
                        dat = "0";
                    cQuery = " update " + DB_TableName_paper + " set paper_weight='" + dat + "' where row_id='" + _row_id + "'";
                }
                else if (cpos.Equals(7))    //
                {
                    cQuery = " update " + DB_TableName_paper + " set paper_name='" + dat + "' where row_id='" + _row_id + "'";
                }
                else if (cpos.Equals(8))    //
                {
                    cQuery = " update " + DB_TableName_paper + " set paper_color='" + dat + "' where row_id='" + _row_id + "'";
                }
                else if (cpos.Equals(10))    //
                {
                    if (dat == "" || dat == " ")
                        dat = "0";
                    cQuery = " update " + DB_TableName_paper + " set notice_price='" + dat + "' where row_id='" + _row_id + "'";
                    if (rpos < dataGrid1.Rows.Count)
                    {
                        dataGrid1.Selection.Focus(new SourceGrid.Position(rpos + 1, cpos), true);
                        dataGrid1.Select();
                    }

                }
                else if (cpos.Equals(14))    //
                {
                    if (dat == "" || dat == " ")
                        dat = "0";
                    cQuery = " update " + DB_TableName_paper + " set paper_thick='" + dat + "' where row_id='" + _row_id + "'";
                }
                else if (cpos.Equals(18))    //
                {
                    if (dat == "" || dat == " ")
                        dat = "0";
                    cQuery = " update " + DB_TableName_paper + " set sock='" + dat + "' where row_id='" + _row_id + "'";
                }
                else if (cpos.Equals(26))    //
                {
                    if (dat == "" || dat == " ")
                        dat = "0";
                    cQuery = " update " + DB_TableName_paper + " set ton_price='" + dat + "' where row_id='" + _row_id + "'";
                }
                //                 
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("서버 오류발생");
                    }
                    else
                    {
                        DBConn.Close();
                    }
                }
            }
            ValueChangEvent1.ValueChanged += ValueChangedEvent1;
        }

        private void bAdd_Click(object sender, EventArgs e)
        {
            Form_501a Frm = new Form_501a(s_dt);
            Frm.ShowDialog();
            if(Frm.last_id == true)
                bSearch_Click(null, null);
        }

        private void grid1_DoubleClick(object sender, EventArgs e)
        {
            if (dataGrid1.Selection.ActivePosition.Column == -1)
                return;
            //
            object[] rows = dataGrid1.SelectedDataRows;
            DataRowView row = (DataRowView)rows[0];
            //
            if (rows != null && rows.Length > 0)
            {
                int rpos = dataGrid1.Selection.ActivePosition.Row;
                Form_501a Frm = new Form_501a(s_dt, rpos - 1);
                Frm.ShowDialog();
            }
        }

        private void bDelete_Click(object sender, EventArgs e)
        {
            if (MessageBox.Show("선택하신 항목을 삭제합니까 ?", "항목 삭제", MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
            {
                string cQuery = "";
                string where_paper = " where row_id = -1 ";
                string where_manage = " where paper_id = -1 ";
                //
                string a_row = "";
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        a_row = s_dt.Rows[i]["row_id"].ToString();
                        where_paper += " or row_id = '" + a_row + "' ";
                        where_manage += " or paper_id = '" + a_row + "' ";
                    }
                }
                MySqlConnection DBConn;
                DBConn = new MySqlConnection(Config.DB_con1);
                DBConn.Open();
                cQuery = "delete from " + DB_TableName_paper + where_paper;
                var cmd = new MySqlCommand(cQuery, DBConn);
                if (cmd.ExecuteNonQuery() == 0)
                {
                    DBConn.Close();
                    MessageBox.Show("DB 에라발생");
                    return;
                }
                cQuery = "delete from " + DB_TableName_paper_hcust + where_manage;
                cmd = new MySqlCommand(cQuery, DBConn);
                if (cmd.ExecuteNonQuery() == 0)
                {
                    DBConn.Close();
                    MessageBox.Show("DB 에라발생");
                    return;
                }
                MessageBox.Show("삭제하였습니다");
                bSearch_Click(null, null);
            }
        }

        private void bCopy_Click(object sender, EventArgs e)
        {
            MySqlConnection DBConn;
            DBConn = new MySqlConnection(Config.DB_con1);
            DBConn.Open();
            //
            string input_id = "";
            string cQuery = "";
            string paper_id = "";
            int rpos = s_dt.Rows.Count;
            for (int i = 0; i < s_dt.Rows.Count; i++)
            {
                if (s_dt.Rows[i]["check1"].Equals(true))
                {
                    paper_id = s_dt.Rows[i]["row_id"].ToString();
                    input_id = GridHandle.OneDataCopy(DB_TableName_paper, paper_id);
                    cQuery = "update " + DB_TableName_paper + " set notice_price = 0, paper_thick = null where row_id = '" + input_id + "'";
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생1");
                        return;
                    }
                    cQuery = "insert into "+DB_TableName_paper_hcust+" (hcust_id, paper_id) ";
                    cQuery += " select hcust_id, '" + input_id + "' from " + DB_TableName_paper_hcust + " where paper_id = '" + paper_id + "'";
                    cmd = new MySqlCommand(cQuery, DBConn);
                    cmd.ExecuteNonQuery();
                }
            }
            MessageBox.Show("복사하였습니다");
            DBConn.Close();
            bSearch_Click(null, null);
        }

        private void grid1_MouseClick(object sender, MouseEventArgs e)
        {
            Rect ChkArea = new Rect();
            ChkArea.Top = 0;
            ChkArea.Left = 0;
            ChkArea.Bottom = GridHandle.grid.Rows[0].Height;
            ChkArea.Right = 22;

            int m_x = e.X;
            int m_y = e.Y;

            if (m_x > ChkArea.Left && m_x < ChkArea.Right && m_y > ChkArea.Top && m_y < ChkArea.Bottom)  // chk 컬럼 클릭
            {
                if (Chk == false)
                {
                    Chk = true;
                    GridHandle.ChkCheckAll(1);
                }
                else
                {
                    Chk = false;
                    GridHandle.ChkCancel(1);
                }
            }
        }

        private void bSearchManage_Click(object sender, EventArgs e)
        {
            Form_501b Frm = new Form_501b();
            Frm.ShowDialog();
        }

        private void bPuse_Click(object sender, EventArgs e)
        {
            string key_word = "종이용도";
            string cQuery = "select row_id, code1, hang from hang_manage where class = '" + key_word + "' order by no";
            Form_501d Frm = new Form_501d(tbPuse, key_word, cQuery,Cursor.Position.X-150, Cursor.Position.Y );
            Frm.ShowDialog();
        }

        private void bJiup_Click(object sender, EventArgs e)
        {
            string key_word = "지업사";
            string cQuery = "select b.row_id, a.code as code1, b.sangho as hang from C_hcust_jiup_code as a ";
            cQuery += " left outer join C_hcustomer as b on a.hcust_id = b.row_id ";
            Form_501d Frm = new Form_501d(tbJiup, key_word, cQuery, Cursor.Position.X - 150, Cursor.Position.Y);
            Frm.ShowDialog();
        }

        private void bPackTrade_Click(object sender, EventArgs e)
        {
            bool search_id = false;
            MySqlConnection DBConn;
            DBConn = new MySqlConnection(Config.DB_con1);
            DBConn.Open();
            //
            string cQuery = "";
            string item_2 = "";
            string _row_id = "";
            string temp = "";
            //--------------------------------------------------------------------------
            if (tbSgroup.Text != "")  //매엽사이즈 그룹
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_2 = tbSgroup.Text.Trim();
                        cQuery += "update " + DB_TableName_paper + " set paper_size_group = '" + item_2 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            //--------------------------------------------------------------------------- 
            if (tbYgroup.Text != "")  //윤전사이즈 그룹
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_2 = tbYgroup.Text.Trim();
                        cQuery += "update " + DB_TableName_paper + " set yunjeon_size_group = '" + item_2 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            //--------------------------------------------------------------------------- 
            if (tbPuse.Text != "")  //용도
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_2 = tbPuse.Text.Trim();
                        cQuery += "update " + DB_TableName_paper + " set hang_puse_group = '" + item_2 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            //---------------------------------------------------------------tbJiup
            if (tbJiup.Text != "")  //유통회사
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_2 = tbJiup.Text.Trim();
                        cQuery += "update " + DB_TableName_paper + " set supply_company_code = '" + item_2 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            if (search_id)
            {
                MessageBox.Show("교환하였습니다");
                bSearch_Click(null, null);
            }
            //  
            //string sgroup = "";
            //string puse = "";
            //string jiup = "";
            //string row_id = "";

            //for (int i = 1; i < grid1.RowsCount; i++)
            //{
            //    if (grid1[i, 1].Value.Equals(true))
            //    {
            //        Trade_package_item(i, 11, tbSgroup, 1, "");     // 사이즈그룹 교환
            //        Trade_package_item(i, 17, tbPuse, 1, "");        // 종이용도 교환
            //        Trade_package_item(i, 18, tbJiup, 3, "#");        // 지업사 교환

            //        row_id = grid1[i, 0].ToString();  //paper_id
            //        sgroup = grid1[i, 11].ToString();
            //        puse = grid1[i, 17].ToString();
            //        jiup = "#"+grid1[i, 18].ToString();

            //        package_update(row_id, sgroup, puse, jiup);
            //    }
            //}
            //grid1.Refresh();
            //MessageBox.Show("교환하였습니다");
        }
        //private void Trade_sgroup(int rpos, int cpos)
        //{
        //    if (tbSgroup.Text == "")
        //        return;
        //    cell_d cc = new cell_d();
        //    grid1[rpos, cpos] = new SourceGrid.Cells.Cell("", typeof(string));
        //    string old_item = grid1[rpos, cpos].ToString();
        //    string result = add_item(old_item, tbSgroup.Text, 1, "");
        //    string row_id = grid1[rpos, 0].ToString();

        //    grid1[rpos, cpos] = new SourceGrid.Cells.Cell(result, typeof(string));
        //    grid1[rpos, cpos].View = cc.center_cell;
        //    grid1[rpos, cpos].Editor = cc.disable_cell;

        //}

        //private void Trade_puse(int rpos, int cpos)
        //{
        //    if (tbPuse.Text == "") 
        //        return;
        //    cell_d cc = new cell_d();
        //    grid1[rpos, cpos] = new SourceGrid.Cells.Cell("", typeof(string));
        //    string old_item = grid1[rpos, cpos].ToString();
        //    string result = add_item(old_item, tbPuse.Text, 1, "");
        //    string row_id = grid1[rpos, 0].ToString();

        //    grid1[rpos, cpos] = new SourceGrid.Cells.Cell(result, typeof(string));
        //    grid1[rpos, cpos].View = cc.center_cell;
        //    grid1[rpos, cpos].Editor = cc.disable_cell;
        //}

        //private void Trade_jiup(int rpos, int cpos)
        //{
        //    if (tbJiup.Text == "")
        //        return;
        //    cell_d cc = new cell_d();
        //    grid1[rpos, cpos] = new SourceGrid.Cells.Cell("", typeof(string));
        //    string old_item = grid1[rpos, 17].ToString();
        //    string result = add_item(old_item, tbJiup.Text, 2, "#");

        //    grid1[rpos, cpos] = new SourceGrid.Cells.Cell(result, typeof(string));
        //    grid1[rpos, cpos].View = cc.center_cell;
        //    grid1[rpos, cpos].Editor = cc.disable_cell;


        //}
        private void Trade_package_item(int rpos, int cpos, TextBox tb, int item_len, string gubun)
        {
            //if (tb.Text == "")
            //    return;
            //cell_d cc = new cell_d();
            //grid1[rpos, cpos] = new SourceGrid.Cells.Cell("", typeof(string));
            //string old_item = grid1[rpos, cpos].ToString();
            //string result = add_item(old_item, tb.Text, item_len, gubun);
            //string row_id = grid1[rpos, 0].ToString();

            //grid1[rpos, cpos] = new SourceGrid.Cells.Cell(result, typeof(string));
            //grid1[rpos, cpos].View = cc.left_cell;
            //grid1[rpos, cpos].Editor = cc.disable_cell;
        }

        private void Add_package_item(int rpos, int cpos, TextBox tb, int item_len, string gubun)
        {
            //if (tb.Text == "")
            //    return;
            //cell_d cc = new cell_d();
            //string old_item = grid1[rpos, cpos].ToString();
            //string result = add_item(old_item, tb.Text, item_len, gubun);

            //grid1[rpos, cpos] = new SourceGrid.Cells.Cell(result, typeof(string));
            //grid1[rpos, cpos].View = cc.left_cell;
            //grid1[rpos, cpos].Editor = cc.disable_cell;

        }

        private void Del_package_item(int rpos, int cpos, TextBox tb, int item_len, string gubun)
        {
            //if (tb.Text == "")
            //    return;
            //cell_d cc = new cell_d();
            //string old_item = grid1[rpos, cpos].ToString();
            //string result = del_item(old_item, tb.Text, item_len, gubun);

            //if (result == "" && (cpos== 11 || cpos == 18))
            //{
            //    MessageBox.Show(grid1[rpos, 2].ToString() + "번의 데이터가 없습니다. 삭제하지 않습니다");
            //    result = old_item;
            //}
            //grid1[rpos, cpos] = new SourceGrid.Cells.Cell(result, typeof(string));
            //grid1[rpos, cpos].View = cc.left_cell;
            //grid1[rpos, cpos].Editor = cc.disable_cell;

        }

        private string add_item(string old_item, string new_item, int item_size, string gubun)   // 추가.
        {
            string final_item = old_item;

            for (int i = 0; i <= new_item.Length - item_size; i++)
            {
                if (new_item.Substring(i, item_size).IndexOf("#") < 0)   // #이 있지 않으면..
                {
                    final_item = final_item.Replace(new_item.Substring(i, item_size), "");
                    final_item += gubun + new_item.Substring(i, item_size);
                    final_item = final_item.Replace("##", "#");
                }
            }

            if (final_item.Length > 0 && final_item.Substring(0, 1) == "#")
                final_item = final_item.Substring(1);

            return final_item;
        }

        private string del_item(string old_item, string new_item, int item_size, string gubun)   // 추가.
        {
            string final_item = old_item;

            for (int i = 0; i <= new_item.Length - item_size; i++)
            {
                if (new_item.Substring(i, item_size).IndexOf("#") < 0)   // #이 있지 않으면..
                {
                    final_item = final_item.Replace(new_item.Substring(i, item_size), "");
                    final_item = final_item.Replace("##", "#");
                }
            }

            if (final_item.Length > 0 && final_item.Substring(0, 1) == "#")
                final_item = final_item.Substring(1);

            if (final_item.Length > 0 && final_item.Substring(final_item.Length - 1, 1) == "#")
                final_item = final_item.Substring(0, final_item.Length - 1);

            return final_item;
        }

        //private void Add_sgroup(int rpos, int cpos)
        //{
        //    if (tbSgroup.Text == "")
        //        return;
        //    cell_d cc = new cell_d();
        //    string old_item = grid1[rpos, cpos].ToString();
        //    string result = add_item(old_item, tbSgroup.Text, 1, "");

        //    grid1[rpos, cpos] = new SourceGrid.Cells.Cell(result, typeof(string));
        //    grid1[rpos, cpos].View = cc.center_cell;
        //    grid1[rpos, cpos].Editor = cc.disable_cell;

        //}

        //private void Add_puse(int rpos, int cpos)
        //{
        //    if (tbPuse.Text == "")
        //        return;
        //    cell_d cc = new cell_d();
        //    string old_item = grid1[rpos, cpos].ToString();
        //    string result = add_item(old_item, tbPuse.Text, 1, "");

        //    grid1[rpos, cpos] = new SourceGrid.Cells.Cell(result, typeof(string));
        //    grid1[rpos, cpos].View = cc.center_cell;
        //    grid1[rpos, cpos].Editor = cc.disable_cell;
        //}

        //private void Add_jiup(int rpos, int cpos)
        //{
        //    if (tbJiup.Text == "")
        //        return;
        //    cell_d cc = new cell_d();
        //    string old_item = grid1[rpos, 17].ToString();
        //    string result = add_item(old_item, tbJiup.Text, 2, "#");

        //    grid1[rpos, cpos] = new SourceGrid.Cells.Cell(result, typeof(string));
        //    grid1[rpos, cpos].View = cc.center_cell;
        //    grid1[rpos, cpos].Editor = cc.disable_cell;

        //}

        private void bPackAdd_Click(object sender, EventArgs e)
        {
            bool search_id = false;
            MySqlConnection DBConn;
            DBConn = new MySqlConnection(Config.DB_con1);
            DBConn.Open();
            //
            string cQuery = "";
            string item_1 = "";
            string item_2 = "";
            string _row_id = "";
            string temp = "";
            //--------------------------------------------------------------------------
            if (tbSgroup.Text != "")  //매엽사이즈 그룹
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_1 = s_dt.Rows[i]["paper_size_group"].ToString();
                        item_2 = tbSgroup.Text.Trim();
                        for (int x = 0; x < item_2.Length; x++)
                        {
                            temp = item_2.Substring(x, 1);
                            item_1 = item_1.Replace(temp, "");
                        }
                        item_1 += item_2;
                        // 
                        cQuery += "update " + DB_TableName_paper + " set paper_size_group = '" + item_1 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            //--------------------------------------------------------------------------- 
            if (tbYgroup.Text != "")  //윤전사이즈 그룹
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_1 = s_dt.Rows[i]["yunjeon_size_group"].ToString();
                        item_2 = tbYgroup.Text.Trim();
                        for (int x = 0; x < item_2.Length; x++)
                        {
                            temp = item_2.Substring(x, 1);
                            item_1 = item_1.Replace(temp, "");
                        }
                        item_1 += item_2;
                        // 
                        cQuery += "update " + DB_TableName_paper + " set yunjeon_size_group = '" + item_1 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            //--------------------------------------------------------------------------- 
            if (tbPuse.Text != "")  //용도
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_1 = s_dt.Rows[i]["hang_puse_group"].ToString();
                        item_2 = tbPuse.Text.Trim();
                        for (int x = 0; x < item_2.Length; x++)
                        {
                            temp = item_2.Substring(x, 1);
                            item_1 = item_1.Replace(temp, "");
                        }
                        item_1 += item_2;
                        // 
                        cQuery += "update " + DB_TableName_paper + " set hang_puse_group = '" + item_1 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            //---------------------------------------------------------------tbJiup
            if (tbJiup.Text != "")  //유통회사
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_1 = s_dt.Rows[i]["supply_company_code"].ToString();
                        item_2 = tbJiup.Text.Trim();
                        string[] temp_d = item_2.Split(new char[1] { '#' });
                        string[] temp_f = item_1.Split(new char[1] { '#' });
                        //
                        for (int x = 0; x < temp_d.Length; x++)
                        {
                            temp = temp_d[x].ToString();
                            for (int m = 0; m < temp_f.Length; m++)
                            {
                                if (temp == temp_f[m])
                                {
                                    temp_f[m] = "";
                                }
                            }
                        }
                        //
                        item_1 = "";
                        for (int m = 0; m < temp_f.Length; m++)
                        {
                            if (temp_f[m] != "")
                                item_1 += temp_f[m] + "#";
                        }
                        item_1 += item_2;
                        cQuery += "update " + DB_TableName_paper + " set supply_company_code = '" + item_1 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            if (search_id)
            {
                MessageBox.Show("추가하였습니다");
                bSearch_Click(null, null);
            }
            // 
            //string sgroup = "";
            //string puse = "";
            //string jiup = "";
            //string row_id = "";

            //for (int i = 1; i < grid1.RowsCount; i++)
            //{
            //    if (grid1[i, 1].Value.Equals(true))
            //    {
            //        Add_package_item(i, 11, tbSgroup, 1, "");     // 사이즈그룹 교환
            //        Add_package_item(i, 17, tbPuse, 1, "");        // 종이용도 교환
            //        Add_package_item(i, 18, tbJiup, 3, "#");        // 지업사 교환

            //        row_id = grid1[i, 0].ToString();  //paper_id
            //        sgroup = grid1[i, 11].ToString();
            //        puse = grid1[i, 17].ToString();
            //        jiup = "#" + grid1[i, 18].ToString();

            //        package_update(row_id, sgroup, puse, jiup);
            //    }
            //}
            //grid1.Refresh();
            //MessageBox.Show("추가하였습니다");
        }

        private void package_update(string row_id, string sgroup, string puse, string jiup)
        {
            string cQuery = "";
            string delete_where = " where row_id = -1 ";

            DataTable DT_server = new DataTable();      // 종이 & 협력업체 조인 테이블
            DataTable DT_jiup_code = new DataTable();   // 지업사 코드표
            MySqlConnection DBConn = new MySqlConnection(Config.DB_con1);
            DBConn.Open();
            cQuery = "select a.row_id, a.hcust_id, a.paper_id, b.code from " + DB_TableName_paper_hcust + " as a";
            cQuery += " left outer join " + DB_TableName_cust_code + " as b on a.hcust_id = b.hcust_id";
            MySqlDataAdapter returnVal = new MySqlDataAdapter(cQuery, DBConn);
            returnVal.Fill(DT_server);
            returnVal.Dispose();
            cQuery = "select * from " + DB_TableName_cust_code;
            returnVal = new MySqlDataAdapter(cQuery, DBConn);
            returnVal.Fill(DT_jiup_code);
            returnVal.Dispose();

            DBConn.Close();
            DataRow[] dr;
            cQuery = "update " + DB_TableName_paper + " set paper_size_group ='" + sgroup + "', hang_puse_group = '" + puse + "' where row_id = '" + row_id + "'";
            GridHandle.DataUpdate(cQuery);

            dr = DT_server.Select("paper_id = '" + row_id + "'");
            for (int y = 0; y < dr.Length; y++)
            {
                if (jiup == jiup.Replace("#" + dr[y]["code"].ToString(), ""))  // 바꿀 항목이 없으면 삭제된 데이터임.
                {
                    delete_where += " or row_id ='" + dr[y]["row_id"].ToString() + "'";
                }
                else
                    jiup = jiup.Replace("#" + dr[y]["code"].ToString(), "");
            }
            cQuery = "delete from " + DB_TableName_paper_hcust + delete_where;
            GridHandle.DataUpdate(cQuery);

            for (int y = 0; y <= jiup.Length - 4; y = y + 4)
            {
                dr = DT_jiup_code.Select("code = '" + jiup.Substring(y + 1, 3) + "'");
                if (dr.Length != 0)
                {
                    cQuery = "insert into " + DB_TableName_paper_hcust + " (hcust_id, paper_id) values('" + dr[0]["hcust_id"].ToString() + "', '" + row_id + "')";
                    GridHandle.DataUpdate(cQuery);
                }
            }
        }

        private void bPackRemove_Click(object sender, EventArgs e)  //항목 제거
        {
            bool search_id = false;
            MySqlConnection DBConn;
            DBConn = new MySqlConnection(Config.DB_con1);
            DBConn.Open();
            //
            string cQuery = "";
            string item_1 = "";
            string item_2 = "";
            string _row_id = "";
            string temp = "";
            //--------------------------------------------------------------------------
            if(tbSgroup.Text != "")  //매엽사이즈 그룹
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_1 = s_dt.Rows[i]["paper_size_group"].ToString();
                        item_2 = tbSgroup.Text.Trim();
                        for(int x = 0; x < item_2.Length; x++)
                        {
                            temp = item_2.Substring(x , 1);
                            item_1 = item_1.Replace(temp,""); 
                        }
                        cQuery += "update " + DB_TableName_paper + " set paper_size_group = '" + item_1 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생1");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            //--------------------------------------------------------------------------- 
            if(tbYgroup.Text != "")  //윤전사이즈 그룹
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_1 = s_dt.Rows[i]["yunjeon_size_group"].ToString();
                        item_2 = tbYgroup.Text.Trim();
                        for(int x = 0; x < item_2.Length; x++)
                        {
                            temp = item_2.Substring(x , 1);
                            item_1 = item_1.Replace(temp,""); 
                        }
                        cQuery += "update " + DB_TableName_paper + " set yunjeon_size_group = '" + item_1 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생2");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            //--------------------------------------------------------------------------- 
            if (tbPuse.Text != "")  //용도
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_1 = s_dt.Rows[i]["hang_puse_group"].ToString();
                        item_2 = tbPuse.Text.Trim();
                        for (int x = 0; x < item_2.Length; x++)
                        {
                            temp = item_2.Substring(x, 1);
                            item_1 = item_1.Replace(temp, "");
                        }
                        cQuery += "update " + DB_TableName_paper + " set hang_puse_group = '" + item_1 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생3");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            //---------------------------------------------------------------tbJiup
            if (tbJiup.Text != "")  //유통회사
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        _row_id = s_dt.Rows[i]["row_id"].ToString();
                        item_1 = s_dt.Rows[i]["supply_company_code"].ToString();
                        item_2 = tbJiup.Text.Trim();
                        string[] temp_d = item_2.Split(new char[1] { '#' });
                        string[] temp_f = item_1.Split(new char[1] { '#' });  
                        //
                        for (int x = 0; x < temp_d.Length; x++)
                        {
                            temp = temp_d[x].ToString();
                            for (int m = 0; m < temp_f.Length; m++)
                            {
                                if (temp == temp_f[m])
                                {
                                    temp_f[m] = "";
                                }
                            }
                        }
                        //
                        item_1 = "";
                        for (int m = 0; m < temp_f.Length; m++)
                        {
                            if (temp_f[m] != "")
                                item_1 += temp_f[m] + "#";  
                        }
                        cQuery += "update " + DB_TableName_paper + " set supply_company_code = '" + item_1 + "'";
                        cQuery += " where row_id = '" + _row_id + "';";
                    }
                }
                if (cQuery != "")
                {
                    var cmd = new MySqlCommand(cQuery, DBConn);
                    if (cmd.ExecuteNonQuery() == 0)
                    {
                        DBConn.Close();
                        MessageBox.Show("DB 에라발생4");
                        return;
                    }
                    else
                    {
                        search_id = true;
                        cQuery = "";
                    }
                }
            }
            if (search_id)
            {
                MessageBox.Show("제거하였습니다");
                bSearch_Click(null, null);
            }
            // 
            //for (int i = 1; i < grid1.RowsCount; i++)
            //{
            //    if (grid1[i, 1].Value.Equals(true))
            //    {

            //        Del_package_item(i, 11, tbSgroup, 1, "");     // 사이즈그룹 교환
            //        Del_package_item(i, 17, tbPuse, 1, "");        // 종이용도 교환
            //        Del_package_item(i, 18, tbJiup, 3, "#");        // 지업사 교환

            //        row_id = grid1[i, 0].ToString();  //paper_id
            //        sgroup = grid1[i, 11].ToString();
            //        puse = grid1[i, 17].ToString();
            //        jiup = "#" + grid1[i, 18].ToString();

            //        package_update(row_id, sgroup, puse, jiup);
            //    }
            //}
            //grid1.Refresh();
            //MessageBox.Show("제거하였습니다");
        }

        private void bPackClear_Click(object sender, EventArgs e)
        {
            tbSgroup.Text = "";
            tbPuse.Text = "";
            tbJiup.Text = "";
            tbYgroup.Text = "";
            //
            tbSgroup.Refresh();
            tbPuse.Refresh();
            tbJiup.Refresh();
            tbYgroup.Refresh();
        }

        private void bPackMody_Click(object sender, EventArgs e)
        {
            if (MessageBox.Show("수정하시겠습니까?", "수정", MessageBoxButtons.YesNo, MessageBoxIcon.Warning, MessageBoxDefaultButton.Button2) == DialogResult.Yes)
            {
                string set_itemp = "";

                if (cbBunryu.Text != "")
                    set_itemp += ", hang_class_code = (select code1 from hang_manage where class = '%분류' and hang = '" + cbBunryu.Text.Trim() + "')";

                if (cbPgroup.Text != "")
                    set_itemp += ", hang_pgroup_code = (select code1 from hang_manage where class = '종이그룹' and hang = '" + cbPgroup.Text.Trim() + "')";

                if (cbPmake.Text != "")
                    set_itemp += ", hang_pmake_code = (select code1 from hang_manage where class = '제지사' and hang = '" + cbPmake.Text.Trim() + "')";

                if (tbWeight.Text != "")
                    set_itemp += ", paper_weight = '" + tbWeight.Text.Trim() + "'";

                if (tbThick.Text != "")
                    set_itemp += ", paper_thick = '" + tbThick.Text.Trim() + "'";

                if (cbSock.Text != "")
                    set_itemp += ", sock = '" + cbSock.Text.Trim() + "'";

                if (cbSunsu.Text != "")
                    set_itemp += ", sunsu = '" + cbSunsu.Text.Trim() + "'";

                if (tbNoticePrice.Text != "")
                    set_itemp += ", notice_price = '" + tbNoticePrice.Text.Trim() + "'";

                if (tbTonsu.Text.Trim() != "")
                    set_itemp += ", ton_su = '" + tbTonsu.Text.Trim() + "'";

                if (set_itemp == "")
                    return;
                set_itemp = set_itemp.Substring(1);   // , 를 자름

                string where = " where row_id = -1";

                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        where += " or row_id = '" + s_dt.Rows[i]["row_id"].ToString() + "' ";
                    }
                }
                MySqlConnection DBConn;
                DBConn = new MySqlConnection(Config.DB_con1);
                DBConn.Open();
                //
                string cQuery = "update " + DB_TableName_paper + " set " + set_itemp + where;
                var cmd = new MySqlCommand(cQuery, DBConn);
                if (cmd.ExecuteNonQuery() == 0)
                {
                    DBConn.Close();
                    MessageBox.Show("DB 에라발생");
                    return;
                }
                else
                {
                    DBConn.Close();
                    MessageBox.Show("수정하였습니다");
                    bSearch_Click(null, null);
                }
            }
        }

        private void button1_Click(object sender, EventArgs e)
        {
            string key_word = "종이용도";
            string cQuery = "select row_id, code1, hang from hang_manage where class = '" + key_word + "' order by no";
            Form_501d Frm = new Form_501d(tbS_puse, key_word, cQuery, Cursor.Position.X, Cursor.Position.Y);
            Frm.ShowDialog();
        }

        private void bClear_Click(object sender, EventArgs e)
        {
            cbS_bunryu.Text = "";
            cbS_pgroup.Text = "";
            cbS_weight1.Text = "";
            cbS_weight2.Text = "";
            cbS_pname.Text = "";
            tbS_pcolor.Text = "";
            cbS_pmake.Text = "";
            tbS_sgroup.Text = "";
            cbS_sock.Text = "";
            cbS_sunsu.Text = "";
            tbS_puse.Text = "";
            textBox1.Text = "";
            rbPname.Checked = true;
            rbPmake.Checked = false;
            rbPgroup.Checked = false;
            rbBunryu.Checked = false;

            cbS_bunryu.Refresh();
            cbS_pgroup.Refresh();
            cbS_weight1.Refresh();
            cbS_weight2.Refresh();
            cbS_pname.Refresh();
            tbS_pcolor.Refresh();
            cbS_pmake.Refresh();
            tbS_sgroup.Refresh();
            cbS_sock.Refresh();
            cbS_sunsu.Refresh();
            tbS_puse.Refresh();
            textBox1.Refresh();
        }

        private void bSearch_Click(object sender, EventArgs e)
        {
            string s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11, s12;
            string order_by = "";
            if (cbS_bunryu.Text != "")
                s1 = " and d.hang = '" + cbS_bunryu.Text + "'";
            else
                s1 = "";

            if (cbS_pgroup.Text != "")
                s2 = " and e.hang = '" + cbS_pgroup.Text + "'";
            else
                s2 = "";
            
            if (cbS_weight1.Text != "")
                s3 = " and paper_weight >= " + cbS_weight1.Text;
            else
                s3 = "";

            if (cbS_weight2.Text != "")
                s4 = " and paper_weight <= " + cbS_weight2.Text;
            else
                s4 = "";

            if (cbS_pname.Text != "")
                s5 = " and paper_name like '%"+cbS_pname.Text+"%'";
            else
                s5 = "";

            if (tbS_pcolor.Text != "")
                s6 = " and paper_color like '%"+tbS_pcolor.Text+"%'";
            else
                s6 = "";

            if (cbS_pmake.Text != "")
                s7 = " and f.hang = '" + cbS_pmake.Text + "'";
            else
                s7 = "";

            if (tbS_sgroup.Text != "")
            {
                s8 = "";
                for (int i = 0; i < tbS_sgroup.Text.Length; i++)
                    s8 += "%" + tbS_sgroup.Text.Substring(i, 1);

                s8 = " and paper_size_group like '" + s8 + "%'";
            }
            else
                s8 = "";

            if (cbS_sock.Text != "")
                s9 = " and sock = "+cbS_sock.Text;
            else
                s9 = "";

            if (cbS_sunsu.Text != "")
                s10 = " and sunsu = "+cbS_sunsu.Text;
            else
                s10 = "";

            if (tbS_puse.Text != "")
            {
                s11 = "";
                for (int i = 0; i < tbS_puse.Text.Length; i++)
                    s11 += "%" + tbS_puse.Text.Substring(i, 1);

                s11 = " and hang_puse_group like '" + s11 + "%'";
            }
            else
                s11 = "";

            if (textBox1.Text != "")
            {
                s12 = "";
                for (int i = 0; i < textBox1.Text.Length; i++)
                    s12 += "%" + textBox1.Text.Substring(i, 1);
                //
                s8 = " and yunjeon_size_group like '" + s12 + "%'";
            }
            else
                s12 = "";

            if (rbBunryu.Checked == true)
                order_by = " order by bunryu, a.paper_weight, a.row_id, c.code";
            else if (rbPgroup.Checked == true)
                order_by = " order by pgroup, a.paper_weight, a.row_id, c.code";
            else if (rbPmake.Checked == true)
                order_by = " order by pmake, a.paper_weight, a.row_id, c.code";
            else
                order_by = " order by paper_name, a.paper_weight, a.row_id, c.code";

            string cQuery = "";
            //cQuery = "select h.sangho as sangho, b.*, c.code, d.hang as bunryu, e.hang as pgroup, f.hang as pmake from " + DB_TableName_paper_hcust + " as a ";
            //cQuery += " left outer join " + DB_TableName_paper + " as b on a.paper_id = b.row_id";
            cQuery = "select h.sangho as sangho, a.*, c.code, d.hang as bunryu, e.hang as pgroup, f.hang as pmake, g.hang as p_use from " + DB_TableName_paper + " as a ";
            cQuery += " left outer join " + DB_TableName_paper_hcust + " as b on b.paper_id = a.row_id";
            cQuery += " left outer join " + DB_TableName_cust_code + " as c on b.hcust_id = c.hcust_id";
            cQuery += " left outer join " + DB_TableName_hang + " as d on a.hang_class_code = d.code1 and d.class = '%분류' ";
            cQuery += " left outer join " + DB_TableName_hang + " as e on a.hang_pgroup_code = e.code1 and e.class = '종이그룹'";
            cQuery += " left outer join " + DB_TableName_hang + " as f on a.hang_pmake_code = f.code1 and f.class = '제지사' ";
            cQuery += " left outer join " + DB_TableName_hang + " as g on a.hang_puse_group = g.code1 and g.class = '종이용도' ";
            cQuery += " left outer join " + DB_TableName_hcust + " as h on a.hcust_id = h.row_id";
            cQuery += " where a.row_id > 0 " + s1 + s2 + s3 + s4 + s5 + s6 + s7 + s8 + s9 + s10 + s11;
            cQuery += order_by;
            Refresh(cQuery);

        }

        private void bMClear_Click(object sender, EventArgs e)
        {
            cbBunryu.Text = "";
            cbPgroup.Text = "";
            cbPmake.Text = "";
            tbWeight.Text = "";
            tbThick.Text = "";
            cbSock.Text = "";
            cbSunsu.Text = "";

            cbBunryu.Refresh();
            cbPgroup.Refresh();
            cbPmake.Refresh();
            tbWeight.Refresh();
            tbThick.Refresh();
            cbSock.Refresh();
            cbSunsu.Refresh();
        }

        private void bManage_Click(object sender, EventArgs e)
        {
            bool chk_value = false;
            for (int i = 0; i < s_dt.Rows.Count; i++)   // 
            {
                if (s_dt.Rows[i]["check1"].Equals(true))
                {
                    chk_value = true;
                }
            }
            if(chk_value == false)
            {
                MessageBox.Show("종이를 선택해 주세요.");
                return;
            }
            string row_id_temp = " row_id = -1 ";
            string key_word = "manage";
            string cQuery = "select * from C_hcustomer where yubjong like '%4001%' ";
            string Query = "";

            Form_501d Frm = new Form_501d(tbS_puse, key_word, cQuery, Cursor.Position.X, Cursor.Position.Y);
            if (Frm.ShowDialog() == DialogResult.OK)
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        row_id_temp += " or row_id = " + s_dt.Rows[i]["row_id"].ToString();

                        if (Frm.manage_row_id == "-1")
                            s_dt.Rows[i]["sangho"] = "";
                        else
                            s_dt.Rows[i]["sangho"] = Frm.manage_sangho;
                    }
                }
                if (Frm.manage_row_id == "-1")
                {
                    Query = "update C_paper set hcust_id = '0' where " + row_id_temp;
                    GridHandle.DataUpdate(Query);
                    MessageBox.Show("관리 업체가 제거 되었습니다.");
                }
                else
                {
                    Query = "update C_paper set hcust_id = '"+Frm.manage_row_id+"' where " + row_id_temp;
                    GridHandle.DataUpdate(Query);
                    MessageBox.Show("관리 업체가 선택 되었습니다.");
                }
                dataGrid1.Refresh();
            }
        }

        private void tbManage_TextChanged(object sender, EventArgs e)
        {
           // if(tbManage.Text == "-1")
        }

        private void bMacro_add_Click(object sender, EventArgs e)
        {
            if (MessageBox.Show("선택하신 항목을 추가합니까 ?", "항목 삭제", MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
            {
                DataTable m_paper = new DataTable();
                MySqlConnection DBConn;
                DBConn = new MySqlConnection(Config.DB_con1);
                util.Con_DB_Open(ref DBConn);

                
                string Query = "select row_id, c_row_id from M_paper";
                dt.make(Config.DB_conMacro, m_paper, Query);

                string paper_row = "where row_id = -1";
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        string cQuery = "select hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group from " + DB_TableName_paper + " where row_id = " + s_dt.Rows[i]["row_id"].ToString();
                        var cmd = new MySqlCommand(cQuery, DBConn);
                        var myRead = cmd.ExecuteReader();
                        if (myRead.Read())
                        {
                            DataRow[] dr = m_paper.Select("c_row_id = '" + s_dt.Rows[i]["row_id"].ToString() + "'");
                            if (dr.Length == 0)
                            {
                                Query = "insert into M_paper(hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group, c_row_id) ";
                                Query += " values('" + myRead["hang_class_code"].ToString() + "', '" + myRead["hang_pgroup_code"].ToString() + "', '" + myRead["paper_weight"].ToString() + "', '" + myRead["paper_name"].ToString() + "', ";
                                Query += " '" + myRead["paper_color"].ToString() + "', '" + myRead["notice_price"].ToString() + "', '" + myRead["paper_size_group"].ToString() + "', ";
                                Query += " '" + myRead["paper_thick"].ToString() + "', '" + myRead["hang_puse_group"].ToString() + "', '" + s_dt.Rows[i]["row_id"].ToString() + "')";
                                kc_macro.DataUpdate(Query);
                                // 
                                paper_row += " or row_id = " + s_dt.Rows[i]["row_id"].ToString();
                            }
                        }
                        myRead.Close();
                    }
                }
                Query = "update " + DB_TableName_paper + " set macro = 1 " + paper_row;
                GridHandle.DataUpdate(Query);
                DBConn.Close();
                MessageBox.Show("완료 되었습니다.");
            }
        }

        private void bMacro_del_Click(object sender, EventArgs e)  
        {
            string c_paper_row = " where row_id = -1 ";
            string m_paper_row = " where c_row_id = -1";
            if (MessageBox.Show("선택하신 메크로 항목을 삭제합니까 ?", "항목 삭제", MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
            {
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        c_paper_row += " or row_id = " + s_dt.Rows[i]["row_id"].ToString();
                        m_paper_row += " or c_row_id = " + s_dt.Rows[i]["row_id"].ToString();
                    }
                }
                string Query = "update " + DB_TableName_paper + " set macro = 0 " + c_paper_row;
                GridHandle.DataUpdate(Query);
                Query = "delete from M_paper " + m_paper_row;
                kc_macro.DataUpdate(Query);
                MessageBox.Show("완료 되었습니다.");
            }
        }

        private void bMacro_all_sync_Click(object sender, EventArgs e)
        {
            if (MessageBox.Show("전체 동기화 진행 하시겠습니까? ?", "항목 삭제", MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
            {
                Cursor.Current = Cursors.WaitCursor;
                DataTable paper_macro = new DataTable();

                string cQuery = "select row_id, hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group from " + DB_TableName_paper + " where macro = true";
                dt.make(Config.DB_con1, paper_macro, cQuery);


                MySqlConnection DBConn;
                DBConn = new MySqlConnection(Config.DB_conMacro);
                util.Con_DB_Open(ref DBConn);

                DataRow[] dr = paper_macro.Select();
                if (dr.Length != 0)
                {
                    cQuery = "delete from M_paper where ";
                    string paper_row = " where row_id = -1";
                    for (int i = 0; i < dr.Length; i++)
                    {
                        if (i == 0)
                            cQuery += " c_row_id != " + dr[i]["row_id"].ToString();
                        else
                            cQuery += " and c_row_id != " + dr[i]["row_id"].ToString();

                        string Query = "select row_id from M_paper where c_row_id = " + dr[i]["row_id"].ToString();
                        var cmd = new MySqlCommand(Query, DBConn);
                        var myRead = cmd.ExecuteReader();
                        if (myRead.Read())
                        {
                            Query = "update M_paper set hang_class_code = '"+dr[i]["hang_class_code"]+"', hang_pgroup_code = '" + dr[i]["hang_pgroup_code"] + "',  paper_weight = '" + dr[i]["paper_weight"] + "',";
                            Query += " paper_name = '" + dr[i]["paper_name"] + "', paper_color = '" + dr[i]["paper_color"] + "', notice_price = '" + dr[i]["notice_price"] + "',";
                            Query += " paper_size_group = '" + dr[i]["paper_size_group"] + "', paper_thick = '" + dr[i]["paper_thick"] + "', hang_puse_group = '" + dr[i]["hang_puse_group"] + "' ";
                            Query += " where c_row_id = " + dr[i]["row_id"].ToString();
                            kc_macro.DataUpdate(Query);
                        }
                        else
                        {
                            Query = "insert into M_paper(hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group, c_row_id) ";
                            Query += " values('" + dr[i]["hang_class_code"].ToString() + "', '" + dr[i]["hang_pgroup_code"].ToString() + "', '" + dr[i]["paper_weight"].ToString() + "', '" + dr[i]["paper_name"].ToString() + "', ";
                            Query += " '" + dr[i]["paper_color"].ToString() + "', '" + dr[i]["notice_price"].ToString() + "', '" + dr[i]["paper_size_group"].ToString() + "', ";
                            Query += " '" + dr[i]["paper_thick"].ToString() + "', '" + dr[i]["hang_puse_group"].ToString() + "', '" + dr[i]["row_id"].ToString() + "')";
                            kc_macro.DataUpdate(Query);

                            //paper_row += " or row_id = " + grid1[i, 0].ToString();
                        }
                        myRead.Close();
                    }

                    kc_macro.DataUpdate(cQuery);
                    cQuery = "update " + DB_TableName_paper + " set macro = 1 " + paper_row;
                    GridHandle.DataUpdate(cQuery);
                }
                DBConn.Close();

                

                Cursor.Current = Cursors.Default;
                MessageBox.Show("완료 되었습니다.");
            }
        }

        private void bMacro_chk_sync_Click(object sender, EventArgs e)
        {
            if (MessageBox.Show("선택 항목 동기화 진행 하시겠습니까? ?", "항목 삭제", MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
            {
                Cursor.Current = Cursors.WaitCursor;
                string chk_dat = " where row_id = -1 ";
                //
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        chk_dat += " or row_id = " + s_dt.Rows[i]["row_id"].ToString();
                    }
                }

                DataTable paper_macro = new DataTable();

                string cQuery = "select row_id, hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group from " + DB_TableName_paper + chk_dat;
                dt.make(Config.DB_con1, paper_macro, cQuery);


                MySqlConnection DBConn;
                DBConn = new MySqlConnection(Config.DB_conMacro);
                util.Con_DB_Open(ref DBConn);

                DataRow[] dr = paper_macro.Select();
                if (dr.Length != 0)
                {
                   
                    for (int i = 0; i < dr.Length; i++)
                    {
                        string Query = "select row_id from M_paper where c_row_id = " + dr[i]["row_id"].ToString();
                        var cmd = new MySqlCommand(Query, DBConn);
                        var myRead = cmd.ExecuteReader();
                        if (myRead.Read())
                        {
                            Query = "update M_paper set hang_class_code = '" + dr[i]["hang_class_code"] + "', hang_pgroup_code = '" + dr[i]["hang_pgroup_code"] + "',  paper_weight = '" + dr[i]["paper_weight"] + "',";
                            Query += " paper_name = '" + dr[i]["paper_name"] + "', paper_color = '" + dr[i]["paper_color"] + "', notice_price = '" + dr[i]["notice_price"] + "',";
                            Query += " paper_size_group = '" + dr[i]["paper_size_group"] + "', paper_thick = '" + dr[i]["paper_thick"] + "', hang_puse_group = '" + dr[i]["hang_puse_group"] + "' ";
                            Query += " where c_row_id = " + dr[i]["row_id"].ToString();
                            kc_macro.DataUpdate(Query);
                        }
                        else
                        {
                            Query = "insert into M_paper(hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group, c_row_id) ";
                            Query += " values('" + dr[i]["hang_class_code"].ToString() + "', '" + dr[i]["hang_pgroup_code"].ToString() + "', '" + dr[i]["paper_weight"].ToString() + "', '" + dr[i]["paper_name"].ToString() + "', ";
                            Query += " '" + dr[i]["paper_color"].ToString() + "', '" + dr[i]["notice_price"].ToString() + "', '" + dr[i]["paper_size_group"].ToString() + "', ";
                            Query += " '" + dr[i]["paper_thick"].ToString() + "', '" + dr[i]["hang_puse_group"].ToString() + "', '" + dr[i]["row_id"].ToString() + "')";
                            kc_macro.DataUpdate(Query);
                        }
                        myRead.Close();
                    }
                }
                DBConn.Close();
                cQuery = "update " + DB_TableName_paper + " set macro = 1 " + chk_dat;
                GridHandle.DataUpdate(cQuery);
                Cursor.Current = Cursors.Default;
                MessageBox.Show("완료 되었습니다.");
            }
        }

        private void bShoping_add_Click(object sender, EventArgs e)
        {
            if (MessageBox.Show("선택하신 항목을 추가합니까 ?", "항목 삭제", MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
            {
                DataTable m_paper = new DataTable();
                MySqlConnection DBConn;
                DBConn = new MySqlConnection(Config.DB_con1);
                util.Con_DB_Open(ref DBConn);


                string Query = "select row_id, c_row_id from B_paper";
                dt.make(Config.DB_conMacro, m_paper, Query);

                string paper_row = "where row_id = -1";
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        string cQuery = "select hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group from " + DB_TableName_paper + " where row_id = " + s_dt.Rows[i]["row_id"].ToString();
                        var cmd = new MySqlCommand(cQuery, DBConn);
                        var myRead = cmd.ExecuteReader();
                        if (myRead.Read())
                        {
                            DataRow[] dr = m_paper.Select("c_row_id = '" + s_dt.Rows[i]["row_id"].ToString() + "'");
                            if (dr.Length == 0)
                            {
                                Query = "insert into B_paper(hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group, c_row_id) ";
                                Query += " values('" + myRead["hang_class_code"].ToString() + "', '" + myRead["hang_pgroup_code"].ToString() + "', '" + myRead["paper_weight"].ToString() + "', '" + myRead["paper_name"].ToString() + "', ";
                                Query += " '" + myRead["paper_color"].ToString() + "', '" + myRead["notice_price"].ToString() + "', '" + myRead["paper_size_group"].ToString() + "', ";
                                Query += " '" + myRead["paper_thick"].ToString() + "', '" + myRead["hang_puse_group"].ToString() + "', '" + s_dt.Rows[i]["row_id"].ToString() + "')";
                                kc_macro.DataUpdate(Query);

                                paper_row += " or row_id = " + s_dt.Rows[i]["row_id"].ToString();
                            }
                        }
                        myRead.Close();
                    }
                }
                Query = "update " + DB_TableName_paper + " set shoping = 1 " + paper_row;
                GridHandle.DataUpdate(Query);
                DBConn.Close();
                MessageBox.Show("완료 되었습니다.");
            }
        }

        private void bShoping_all_sync_Click(object sender, EventArgs e)
        {
            if (MessageBox.Show("전체 동기화 진행 하시겠습니까? ?", "항목 삭제", MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
            {
                Cursor.Current = Cursors.WaitCursor;
                DataTable paper_macro = new DataTable();

                string cQuery = "select row_id, hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group from " + DB_TableName_paper + " where macro = true";
                dt.make(Config.DB_con1, paper_macro, cQuery);


                MySqlConnection DBConn;
                DBConn = new MySqlConnection(Config.DB_conMacro);
                util.Con_DB_Open(ref DBConn);



                DataRow[] dr = paper_macro.Select();
                if (dr.Length != 0)
                {
                    cQuery = "delete from B_paper where ";
                    string paper_row = " where row_id = -1";
                    for (int i = 0; i < dr.Length; i++)
                    {
                        if (i == 0)
                            cQuery += " c_row_id != " + dr[i]["row_id"].ToString();
                        else
                            cQuery += " and c_row_id != " + dr[i]["row_id"].ToString();

                        string Query = "select row_id from B_paper where c_row_id = " + dr[i]["row_id"].ToString();
                        var cmd = new MySqlCommand(Query, DBConn);
                        var myRead = cmd.ExecuteReader();
                        if (myRead.Read())
                        {
                            Query = "update B_paper set hang_class_code = '" + dr[i]["hang_class_code"] + "', hang_pgroup_code = '" + dr[i]["hang_pgroup_code"] + "',  paper_weight = '" + dr[i]["paper_weight"] + "',";
                            Query += " paper_name = '" + dr[i]["paper_name"] + "', paper_color = '" + dr[i]["paper_color"] + "', notice_price = '" + dr[i]["notice_price"] + "',";
                            Query += " paper_size_group = '" + dr[i]["paper_size_group"] + "', paper_thick = '" + dr[i]["paper_thick"] + "', hang_puse_group = '" + dr[i]["hang_puse_group"] + "' ";
                            Query += " where c_row_id = " + dr[i]["row_id"].ToString();
                            kc_macro.DataUpdate(Query);
                        }
                        else
                        {
                            Query = "insert into B_paper(hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group, c_row_id) ";
                            Query += " values('" + dr[i]["hang_class_code"].ToString() + "', '" + dr[i]["hang_pgroup_code"].ToString() + "', '" + dr[i]["paper_weight"].ToString() + "', '" + dr[i]["paper_name"].ToString() + "', ";
                            Query += " '" + dr[i]["paper_color"].ToString() + "', '" + dr[i]["notice_price"].ToString() + "', '" + dr[i]["paper_size_group"].ToString() + "', ";
                            Query += " '" + dr[i]["paper_thick"].ToString() + "', '" + dr[i]["hang_puse_group"].ToString() + "', '" + dr[i]["row_id"].ToString() + "')";
                            kc_macro.DataUpdate(Query);

                            //paper_row += " or row_id = " + grid1[i, 0].ToString();
                        }
                        myRead.Close();
                    }

                    kc_macro.DataUpdate(cQuery);
                    cQuery = "update " + DB_TableName_paper + " set shoping = 1 " + paper_row;
                    GridHandle.DataUpdate(cQuery);
                }
                DBConn.Close();

                Cursor.Current = Cursors.Default;
                MessageBox.Show("완료 되었습니다.");
            }
        }

        private void bShoping_chk_sync_Click(object sender, EventArgs e)
        {
            if (MessageBox.Show("선택 항목 동기화 진행 하시겠습니까? ?", "항목 삭제", MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
            {
                Cursor.Current = Cursors.WaitCursor;

                string chk_dat = " where row_id = -1 ";
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                        chk_dat += " or row_id = " + s_dt.Rows[i]["row_id"].ToString();
                }

                DataTable paper_macro = new DataTable();

                string cQuery = "select row_id, hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group from " + DB_TableName_paper + chk_dat;
                dt.make(Config.DB_con1, paper_macro, cQuery);


                MySqlConnection DBConn;
                DBConn = new MySqlConnection(Config.DB_conMacro);
                util.Con_DB_Open(ref DBConn);

                DataRow[] dr = paper_macro.Select();
                if (dr.Length != 0)
                {

                    for (int i = 0; i < dr.Length; i++)
                    {
                        string Query = "select row_id from B_paper where c_row_id = " + dr[i]["row_id"].ToString();
                        var cmd = new MySqlCommand(Query, DBConn);
                        var myRead = cmd.ExecuteReader();
                        if (myRead.Read())
                        {
                            Query = "update B_paper set hang_class_code = '" + dr[i]["hang_class_code"] + "', hang_pgroup_code = '" + dr[i]["hang_pgroup_code"] + "',  paper_weight = '" + dr[i]["paper_weight"] + "',";
                            Query += " paper_name = '" + dr[i]["paper_name"] + "', paper_color = '" + dr[i]["paper_color"] + "', notice_price = '" + dr[i]["notice_price"] + "',";
                            Query += " paper_size_group = '" + dr[i]["paper_size_group"] + "', paper_thick = '" + dr[i]["paper_thick"] + "', hang_puse_group = '" + dr[i]["hang_puse_group"] + "' ";
                            Query += " where c_row_id = " + dr[i]["row_id"].ToString();
                            kc_macro.DataUpdate(Query);
                        }
                        else
                        {
                            Query = "insert into B_paper(hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group, c_row_id) ";
                            Query += " values('" + dr[i]["hang_class_code"].ToString() + "', '" + dr[i]["hang_pgroup_code"].ToString() + "', '" + dr[i]["paper_weight"].ToString() + "', '" + dr[i]["paper_name"].ToString() + "', ";
                            Query += " '" + dr[i]["paper_color"].ToString() + "', '" + dr[i]["notice_price"].ToString() + "', '" + dr[i]["paper_size_group"].ToString() + "', ";
                            Query += " '" + dr[i]["paper_thick"].ToString() + "', '" + dr[i]["hang_puse_group"].ToString() + "', '" + dr[i]["row_id"].ToString() + "')";
                            kc_macro.DataUpdate(Query);
                        }
                        myRead.Close();
                    }
                }
                DBConn.Close();

                cQuery = "update " + DB_TableName_paper + " set shoping = 1 " + chk_dat;
                GridHandle.DataUpdate(cQuery);
                Cursor.Current = Cursors.Default;
                MessageBox.Show("완료 되었습니다.");
            }
        }

        private void bSang_add_Click(object sender, EventArgs e)
        {
            if (MessageBox.Show("선택하신 항목을 추가합니까 ?", "항목 삭제", MessageBoxButtons.YesNo, MessageBoxIcon.Warning) == DialogResult.Yes)
            {
                DataTable m_paper = new DataTable();
                MySqlConnection DBConn;
                DBConn = new MySqlConnection(Config.DB_con1);
                util.Con_DB_Open(ref DBConn);


                string Query = "select row_id, c_row_id from M_paper";
                dt.make(Config.DB_conMacro_sang, m_paper, Query);

                string paper_row = "where row_id = -1";
                for (int i = 0; i < s_dt.Rows.Count; i++)   // 
                {
                    if (s_dt.Rows[i]["check1"].Equals(true))
                    {
                        string cQuery = "select hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group from " + DB_TableName_paper + " where row_id = " + s_dt.Rows[i]["row_id"].ToString();
                        var cmd = new MySqlCommand(cQuery, DBConn);
                        var myRead = cmd.ExecuteReader();
                        if (myRead.Read())
                        {
                            DataRow[] dr = m_paper.Select("c_row_id = '" + s_dt.Rows[i]["row_id"].ToString() + "'");
                            if (dr.Length == 0)
                            {
                                //string hang_puse_group = myRead["hang_puse_group"].ToString();
                                string hang_puse_group = "F";//상가책자는 무조건 F로

                                Query = "insert into M_paper(hang_class_code, hang_pgroup_code, paper_weight, paper_name, paper_color, notice_price, paper_size_group, paper_thick, hang_puse_group, c_row_id) ";
                                Query += " values('" + myRead["hang_class_code"].ToString() + "', '" + myRead["hang_pgroup_code"].ToString() + "', '" + myRead["paper_weight"].ToString() + "', '" + myRead["paper_name"].ToString() + "', ";
                                Query += " '" + myRead["paper_color"].ToString() + "', '" + myRead["notice_price"].ToString() + "', '" + myRead["paper_size_group"].ToString() + "', ";
                                Query += " '" + myRead["paper_thick"].ToString() + "', '" + hang_puse_group + "', '" + s_dt.Rows[i]["row_id"].ToString() + "')";
                                kc_sang.DataUpdate(Query);
                                paper_row += " or row_id = " + s_dt.Rows[i]["row_id"].ToString();
                            }
                        }
                        myRead.Close();
                    }
                }
                Query = "update " + DB_TableName_paper + " set macro = 1 " + paper_row;
                GridHandle.DataUpdate(Query);
                DBConn.Close();
                MessageBox.Show("완료 되었습니다.");
            }
        }

        private void button2_Click(object sender, EventArgs e)  //엑셀변환
        {
            for (int n = 0; n < s_dt.Rows.Count; n++)
            {
                s_dt.Rows[n]["notice_price"] = s_dt.Rows[n]["notice_price"].ToString().Replace(",","");
                s_dt.Rows[n]["paper_weight"] = s_dt.Rows[n]["paper_weight"].ToString().Replace(",", "");
            }
            try
            {
                string l_Path = System.IO.Path.Combine(System.IO.Path.GetTempPath(), "CsvFile.csv");

                using (System.IO.StreamWriter writer = new System.IO.StreamWriter(l_Path, false, System.Text.Encoding.Default))
                {
                    SourceGrid.Exporter.CSV csv = new SourceGrid.Exporter.CSV();
                    csv.Export(dataGrid1, writer);
                    writer.Close();
                }

                DevAge.Shell.Utilities.OpenFile(l_Path);
            }
            catch (Exception err)
            {
                DevAge.Windows.Forms.ErrorDialog.Show(this, err, "CSV Export Error");
            }
            //
            for (int n = 0; n < s_dt.Rows.Count; n++)
            {
                s_dt.Rows[n]["notice_price"] = c_string.Rzero_Icoma(s_dt.Rows[n]["notice_price"].ToString());
                s_dt.Rows[n]["paper_weight"] = c_string.Rzero_Icoma(s_dt.Rows[n]["paper_weight"].ToString());
            }
            dataGrid1.Refresh(); 
        }

        private void bS_sgroup_Click(object sender, EventArgs e)  //매엽사이즈그룹(검색)
        {
            Form_501c Frm = new Form_501c(tbS_sgroup, Cursor.Position.X, Cursor.Position.Y,"매엽");
            Frm.ShowDialog();
        }

        private void button3_Click(object sender, EventArgs e)  //윤전사이즈그룹(검색)
        {
            Form_501c Frm = new Form_501c(textBox1, Cursor.Position.X, Cursor.Position.Y, "윤전");
            Frm.ShowDialog();
        }

        private void bSgroup_Click(object sender, EventArgs e)  //매엽사이즈그룹(수정)
        {
            Form_501c Frm = new Form_501c(tbSgroup, Cursor.Position.X - 200, Cursor.Position.Y, "매엽");
            Frm.ShowDialog();
        }

        private void button4_Click(object sender, EventArgs e)  //윤전사이즈그룹(수정)
        {
            Form_501c Frm = new Form_501c(tbYgroup, Cursor.Position.X - 200, Cursor.Position.Y, "윤전");
            Frm.ShowDialog();
        }

        private void button5_Click(object sender, EventArgs e)
        {
            OpenFileDialog ofd = new OpenFileDialog();
            ofd.DefaultExt = "xlsx";

            ofd.ShowDialog();

            if (ofd.FileName.Length > 0)
            {
                ReadExcel(ofd.FileName);
            }
        }

        private void ReadExcel(string strFilePath)
        {
            Cursor.Current = Cursors.WaitCursor;

            MySqlConnection DBConn;
            DBConn = new MySqlConnection(Config.DB_con1);
            util.Con_DB_Open(ref DBConn);                      

            
            DataTable tempdt = new DataTable();            

            Excel.Application app = new Microsoft.Office.Interop.Excel.Application();
            Excel.Workbook workbook = app.Workbooks.Open(strFilePath);
            Excel.Worksheet worksheet = (Excel.Worksheet)workbook.Worksheets.get_Item(1);
            Excel.Range range = worksheet.UsedRange;
            DataTable exdt = new DataTable();
            object[,] data = range.Value;
           
            string cSql = "insert into C_paper(hang_pgroup_code,paper_weight,paper_name,paper_color,hang_pmake_code,notice_price,paper_thick,sock,ton_su,ton_price) values"; //인서트 쿼리          

          
            string paper_weight = "";           
            string notice_price = "";
            string paper_thick = "";
            string sock = "";
            string ton_su = "";
            string ton_price = "";
            for (int i = 2; i <= data.GetLength(0); i++)
            {                
                paper_weight = (data[i,2] == null  || data[i,2].ToString() == "" ) ? "0":data[i,2].ToString();                 
                notice_price = (data[i, 6] == null || data[i, 6].ToString() == "") ? "0" : data[i, 6].ToString();
                paper_thick = (data[i, 7] == null || data[i, 7].ToString() == "") ? "0" : data[i, 7].ToString();
                sock = (data[i, 8] == null || data[i, 8].ToString() == "") ? "0" : data[i, 8].ToString();
                ton_su = (data[i, 9] == null || data[i, 9].ToString() == "") ? "0" : data[i, 9].ToString();
                ton_price = (data[i, 10] == null || data[i, 10].ToString() == "") ? "0" : data[i, 10].ToString(); ;
                cSql += "('" + data[i, 1] + "','" + paper_weight + "','" + data[i, 3] + "','" + 
                    data[i, 4] + "','" + data[i, 5] + "','" + notice_price + 
                    "','" + paper_thick + "','" + sock + "','" + ton_su + "','" + ton_price  + "'),";              
            }
            cSql = cSql.Substring(0, cSql.Length - 1);
            cSql += ";";
            if (cSql.Contains("values("))
            {
                var cmd = new MySqlCommand(cSql, DBConn);
                cmd.ExecuteNonQuery();
            }
           
            Cursor.Current = Cursors.Default;
            workbook.Close(true);
            app.Quit();

            MessageBox.Show("작업이 완료 되었습니다.");
            
            
        }
        /*
       private void button5_Click(object sender, EventArgs e)
       {
           string File_path = "";
           OpenFileDialog ofd = new OpenFileDialog();
           ofd.DefaultExt = "xlsx";
           if (ofd.ShowDialog() == DialogResult.OK)
           {
               File_path = ofd.FileName;
               ReadExcel(ofd.FileName);
           }
       }

       private void ReadExcel(string strFilePath) 
       {

           MySqlConnection DBConn;
           DBConn = new MySqlConnection(Config.DB_con1);
           DBConn.Open();

           string cQuery = "";
           DataTable tempdt = new DataTable();

           Microsoft.Office.Interop.Excel.Application app = new Microsoft.Office.Interop.Excel.Application();
           Microsoft.Office.Interop.Excel.Workbook workbook = app.Workbooks.Open(strFilePath);
           Microsoft.Office.Interop.Excel.Worksheet worksheet = (Microsoft.Office.Interop.Excel.Worksheet)workbook.Worksheets.get_Item(1);
           Microsoft.Office.Interop.Excel.Range range = worksheet.UsedRange;
           DataTable exdt = new DataTable();

           int m = dataGrid1.Rows.Count;
           int k = 0;
           int s = 0;
           object[,] data = range.Value;

           for (int r = 2; r <= data.GetLength(0); r++)
           {
               for (int c = 1; c <= data.GetLength(1); c++)
               {
                   if (data[r, c] == null)
                   {
                       data[r, c] = "";
                       continue;
                   }
               }

               if (data[r, 3].ToString() == "true")
               {
                   k = 1;
               }
               else
               {
                   k = 0;
               }
               if (data[r, 15].ToString() == "true")
               {
                   s = 1;
               }
               else
               {
                   s = 0;
               }

               try
               {
                   cQuery += " insert into "+ DB_TableName_paper + "(";
                   cQuery += "favorite,paper_weight,paper_name,paper_color,notice_price,paper_size_group,yunjeon_size_group,digital_size_group,";
                   cQuery += "paper_thick,make_company_code,paper_name_code,prove_paper_thick,sock,ton_su,sunsu,hang_puse_group,supply_company_code,macro,ton_price";
                   cQuery += ")";
                   cQuery += " values(" + k +  "," + data[r,4] + ",'" +data[r,5] + "','" +data[r,6] + "',"+ data[r,8] ;
                   cQuery += ",'" + data[r, 9] + "','" + data[r, 10] + "','" + data[r, 11] + "'," + data[r, 12] + ",'" + data[r,13 ] + "','" + data[r,14] + "'," + s + "," + data[r, 16] + ",'" + data[r, 17];
                   cQuery += "','" + data[r, 18] + "','" + data[r, 19] + "','" + data[r, 20] +  "','" + data[r, 23] + "','" + data[r, 24] + "');";

               }
               catch
               {
                   MessageBox.Show("엑셀 파일이 잘못되었습니다");
                   return;
               }
               m++;
           }
           if (cQuery != "")
           {
               var cmd = new MySqlCommand(cQuery, DBConn);
               var myRead = cmd.ExecuteReader();
           }
           workbook.Close(true);
           app.Quit();
           killExcel();
       }

       private void killExcel()
       {
           foreach (System.Diagnostics.Process clsProcess in System.Diagnostics.Process.GetProcesses())
               if (clsProcess.ProcessName.Equals("EXCEL"))  //Process Excel?
                   clsProcess.Kill();
       }
*  * */
    }

}
